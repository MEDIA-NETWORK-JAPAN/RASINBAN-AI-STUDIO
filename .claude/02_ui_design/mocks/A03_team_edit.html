<!--
================================================================================
【画面名称】管理者用 拠点詳細・編集画面 (Admin Team Detail)
【ファイル名】admin_team_detail.html

【概要】
管理者が特定の拠点（チーム）の詳細情報を確認・編集するための画面モックアップです。
Laravel Jetstream + Livewire の管理画面を想定したUIデザインとなっています。

【設計変更点 (APIキー設計変更 v1.6 対応)】
- プラン管理: 拠点単位 → ユーザー単位に変更
- APIキー管理: 拠点単位の独立セクション廃止 → ユーザー編集モーダル内に移動
- Section 1 (基本情報): チーム名のみ（プラン削除）
- Section 2 (ユーザー一覧): ユーザー追加/編集モーダルにプラン+APIキー管理を追加
- Section 3 (危険エリア): Section 4から繰り上がり

【主な機能】
1. 基本情報
   - チーム名の編集のみ（プランはユーザー個別設定）
2. 所属ユーザー管理
   - ユーザー一覧の表示（プラン・APIキー状態も表示）
   - 新規ユーザー追加（モーダル: 名前/メール/パスワード/プラン/APIキー自動生成）
   - 既存ユーザー編集（モーダル: 名前/メール/プラン変更/APIキー管理）
   - ユーザー削除
3. 危険な操作エリア
   - チーム削除機能など

【使用ライブラリ (CDN)】
- Tailwind CSS (スタイリング)
- Alpine.js (モーダル制御、APIキー表示アニメーションなどのインタラクション)
- FontAwesome (アイコン)
================================================================================
-->
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Management - Dify Gateway</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Alpine.js -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body { font-family: 'Noto Sans JP', sans-serif; }
        [x-cloak] { display: none !important; }
    </style>
</head>
<!--
    x-data: ページ全体の状態管理
    - sidebarOpen: モバイル用サイドバーの開閉
    - userModalOpen: ユーザー編集モーダルの開閉
    - addUserModalOpen: ユーザー追加モーダルの開閉
    - currentUser: 編集モーダルで表示するユーザー情報の一時保持用オブジェクト
-->
<body class="bg-gray-50 text-gray-800 antialiased"
      x-data="{
          sidebarOpen: false,
          userModalOpen: false,
          addUserModalOpen: false,
          currentUser: {},

          // ユーザー追加モーダル: 新規APIキー（自動生成）
          newUserApiKey: '',
          generateNewUserApiKey() {
              this.newUserApiKey = 'uak_' + Math.random().toString(36).substring(2, 10) + Math.random().toString(36).substring(2, 10) + Math.random().toString(36).substring(2, 10);
          },

          // ユーザー編集モーダル: APIキー管理
          editUserShowApiKey: false,
          editUserLoading: false,
          editUserDisplayValue: '',
          editUserRealValue: 'uak_v8a9s8d7f6g5h4j3k2l1',
          editUserApiKeyModalOpen: false,

          revealEditUserKey() {
              this.editUserLoading = true;
              setTimeout(() => {
                  this.editUserDisplayValue = this.editUserRealValue;
                  this.editUserShowApiKey = true;
                  this.editUserLoading = false;
              }, 800);
          },

          regenerateEditUserKey() {
              this.editUserApiKeyModalOpen = false;
              this.editUserLoading = true;
              setTimeout(() => {
                  this.editUserRealValue = 'uak_' + Math.random().toString(36).substring(2, 10) + Math.random().toString(36).substring(2, 10);
                  this.editUserDisplayValue = this.editUserRealValue;
                  this.editUserShowApiKey = true;
                  this.editUserLoading = false;
              }, 1000);
          },

          openEditUserModal(user) {
              this.currentUser = user;
              this.editUserShowApiKey = false;
              this.editUserDisplayValue = 'uak_********************';
              this.userModalOpen = true;
          }
      }">

    <!-- ▼▼▼ Mobile Header (スマホ用ヘッダー) ▼▼▼ -->
    <div class="lg:hidden flex items-center justify-between bg-white border-b border-gray-200 px-4 py-3 sticky top-0 z-30">
        <div class="flex items-center gap-3">
            <button @click="sidebarOpen = !sidebarOpen" class="text-gray-500 hover:text-gray-700 focus:outline-none">
                <i class="fas fa-bars text-xl"></i>
            </button>
            <span class="font-bold text-lg text-gray-900">Gateway Admin</span>
        </div>
    </div>
    <!-- ▲▲▲ Mobile Header End ▲▲▲ -->

    <div class="flex h-screen overflow-hidden">

        <!-- ▼▼▼ Sidebar Navigation (サイドバー) ▼▼▼ -->
        <div x-show="sidebarOpen" @click="sidebarOpen = false" x-transition.opacity
             class="fixed inset-0 z-40 bg-gray-900/50 lg:hidden" x-cloak></div>

        <aside :class="sidebarOpen ? 'translate-x-0' : '-translate-x-full'"
               class="fixed inset-y-0 left-0 z-50 w-64 bg-white border-r border-gray-200 transform transition-transform duration-300 ease-in-out lg:static lg:translate-x-0 flex flex-col">

            <div class="h-16 flex items-center px-6 border-b border-gray-100">
                <div class="flex items-center gap-2 text-indigo-600">
                    <i class="fas fa-network-wired text-xl"></i>
                    <span class="font-bold text-xl tracking-tight text-gray-900">Gateway <span class="text-indigo-600">Admin</span></span>
                </div>
            </div>

            <nav class="flex-1 overflow-y-auto py-6 px-3 space-y-1">
                <p class="px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2">Main</p>

                <a href="#" class="flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-50 hover:text-gray-900 group transition-colors">
                    <i class="fas fa-chart-line w-5 text-center text-gray-400 group-hover:text-gray-600"></i>
                    ダッシュボード
                </a>

                <p class="px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider mt-6 mb-2">Management</p>

                <a href="#" class="flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-lg bg-indigo-50 text-indigo-700 group">
                    <i class="fas fa-building w-5 text-center group-hover:text-indigo-600"></i>
                    拠点・ユーザー管理
                </a>

                <a href="#" class="flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-50 hover:text-gray-900 group transition-colors">
                    <i class="fas fa-robot w-5 text-center text-gray-400 group-hover:text-gray-600"></i>
                    Difyアプリ管理
                </a>

                <a href="#" class="flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-50 hover:text-gray-900 group transition-colors">
                    <i class="fas fa-file-invoice-dollar w-5 text-center text-gray-400 group-hover:text-gray-600"></i>
                    利用状況・制限
                </a>

                <p class="px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider mt-6 mb-2">System</p>

                <a href="#" class="flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-50 hover:text-gray-900 group transition-colors">
                    <i class="fas fa-server w-5 text-center text-gray-400 group-hover:text-gray-600"></i>
                    災害復旧 (DR)
                </a>
            </nav>

            <div class="p-4 border-t border-gray-100">
                <div class="flex items-center gap-3">
                    <img src="https://ui-avatars.com/api/?name=Admin+User&background=6366f1&color=fff" alt="Admin" class="h-9 w-9 rounded-full object-cover shadow-sm">
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-medium text-gray-900 truncate">Admin User</p>
                        <p class="text-xs text-gray-500 truncate">admin@example.com</p>
                    </div>
                    <a href="#" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-sign-out-alt"></i>
                    </a>
                </div>
            </div>
        </aside>
        <!-- ▲▲▲ Sidebar End ▲▲▲ -->

        <!-- Main Content Wrapper -->
        <div class="flex-1 flex flex-col overflow-hidden bg-gray-50">

            <!-- Breadcrumb Header -->
            <header class="bg-white border-b border-gray-200 px-8 py-4 flex items-center justify-between">
                <div>
                    <nav class="flex" aria-label="Breadcrumb">
                        <ol class="flex items-center space-x-2">
                            <li><a href="#" class="text-gray-400 hover:text-gray-500"><i class="fas fa-home"></i></a></li>
                            <li><span class="text-gray-300">/</span></li>
                            <li><a href="#" class="text-sm font-medium text-gray-500 hover:text-gray-700">拠点管理</a></li>
                            <li><span class="text-gray-300">/</span></li>
                            <li><span class="text-sm font-medium text-gray-800" aria-current="page">東京本社 営業部</span></li>
                        </ol>
                    </nav>
                    <h1 class="text-xl font-bold text-gray-800 mt-1">拠点編集: 東京本社 営業部</h1>
                </div>

                <div class="flex gap-3">
                    <button class="px-4 py-2 bg-white border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 shadow-sm">キャンセル</button>
                    <button class="px-4 py-2 bg-indigo-600 rounded-lg text-sm font-medium text-white hover:bg-indigo-700 shadow-sm">変更を保存</button>
                </div>
            </header>

            <!-- Main Scrollable Content -->
            <main class="flex-1 overflow-y-auto p-4 lg:p-8">

                <div class="max-w-4xl mx-auto space-y-6">

                    <!-- ▼▼▼ Section 1: Basic Info (基本情報) ▼▼▼ -->
                    <!-- ※ プランはユーザー個別設定のため削除。拠点名のみ管理。 -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-100 bg-gray-50">
                            <h2 class="text-base font-bold text-gray-800 flex items-center gap-2">
                                <i class="fas fa-info-circle text-gray-400"></i> 基本情報
                            </h2>
                        </div>
                        <div class="p-6">
                            <div class="max-w-sm">
                                <label class="block text-sm font-medium text-gray-700 mb-1">チーム名 (拠点名)</label>
                                <input type="text" value="東京本社 営業部" class="w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm py-2 px-3 border">
                            </div>
                        </div>
                    </div>
                    <!-- ▲▲▲ Section 1 End ▲▲▲ -->

                    <!-- ▼▼▼ Section 2: Team Members (所属ユーザー管理) ▼▼▼ -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-100 bg-gray-50 flex items-center justify-between">
                            <h2 class="text-base font-bold text-gray-800 flex items-center gap-2">
                                <i class="fas fa-users text-gray-400"></i> 所属ユーザー管理 (3名)
                            </h2>
                            <!-- Trigger: Add User Modal -->
                            <button @click="addUserModalOpen = true" class="text-sm text-indigo-600 hover:text-indigo-800 font-medium flex items-center gap-1">
                                <i class="fas fa-plus"></i> ユーザー追加
                            </button>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left">
                                <thead class="text-xs text-gray-500 uppercase bg-gray-50 border-b border-gray-100">
                                    <tr>
                                        <th class="px-6 py-3 font-medium">ユーザー名 / メール</th>
                                        <th class="px-6 py-3 font-medium">プラン</th>
                                        <th class="px-6 py-3 font-medium">APIキー</th>
                                        <th class="px-6 py-3 font-medium">登録日</th>
                                        <th class="px-6 py-3 text-right">操作</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-100">
                                    <!-- User Row 1 -->
                                    <tr class="hover:bg-gray-50/50 transition-colors">
                                        <td class="px-6 py-4">
                                            <div class="flex items-center gap-3">
                                                <img src="https://ui-avatars.com/api/?name=Tanaka+Taro&background=random" class="h-9 w-9 rounded-full object-cover">
                                                <div>
                                                    <div class="font-medium text-gray-900">田中 太郎</div>
                                                    <div class="text-gray-500 text-xs">taro.tanaka@example.com</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800">Standard</span>
                                        </td>
                                        <td class="px-6 py-4">
                                            <span class="inline-flex items-center gap-1 text-xs text-green-600"><i class="fas fa-check-circle"></i> 発行済</span>
                                        </td>
                                        <td class="px-6 py-4 text-gray-500">2023-10-01</td>
                                        <td class="px-6 py-4 text-right">
                                            <button @click="openEditUserModal({name: '田中 太郎', email: 'taro.tanaka@example.com', plan: 'standard'})" class="text-indigo-600 hover:text-indigo-900 font-medium text-xs px-2 py-1 rounded hover:bg-indigo-50 transition-colors">
                                                編集
                                            </button>
                                        </td>
                                    </tr>
                                    <!-- User Row 2 -->
                                    <tr class="hover:bg-gray-50/50 transition-colors">
                                        <td class="px-6 py-4">
                                            <div class="flex items-center gap-3">
                                                <img src="https://ui-avatars.com/api/?name=Suzuki+Jiro&background=random&color=333" class="h-9 w-9 rounded-full object-cover">
                                                <div>
                                                    <div class="font-medium text-gray-900">鈴木 次郎</div>
                                                    <div class="text-gray-500 text-xs">jiro.suzuki@example.com</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-700">Light</span>
                                        </td>
                                        <td class="px-6 py-4">
                                            <span class="inline-flex items-center gap-1 text-xs text-green-600"><i class="fas fa-check-circle"></i> 発行済</span>
                                        </td>
                                        <td class="px-6 py-4 text-gray-500">2023-11-15</td>
                                        <td class="px-6 py-4 text-right flex items-center justify-end gap-2">
                                            <button @click="openEditUserModal({name: '鈴木 次郎', email: 'jiro.suzuki@example.com', plan: 'light'})" class="text-indigo-600 hover:text-indigo-900 font-medium text-xs px-2 py-1 rounded hover:bg-indigo-50 transition-colors">
                                                編集
                                            </button>
                                            <button class="text-red-600 hover:text-red-900 font-medium text-xs px-2 py-1 rounded hover:bg-red-50 transition-colors">
                                                削除
                                            </button>
                                        </td>
                                    </tr>
                                    <!-- User Row 3 -->
                                    <tr class="hover:bg-gray-50/50 transition-colors">
                                        <td class="px-6 py-4">
                                            <div class="flex items-center gap-3">
                                                <img src="https://ui-avatars.com/api/?name=Sato+Hanako&background=random&color=333" class="h-9 w-9 rounded-full object-cover">
                                                <div>
                                                    <div class="font-medium text-gray-900">佐藤 花子</div>
                                                    <div class="text-gray-500 text-xs">hanako.sato@example.com</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-800">Pro</span>
                                        </td>
                                        <td class="px-6 py-4">
                                            <span class="inline-flex items-center gap-1 text-xs text-gray-400"><i class="fas fa-minus-circle"></i> 未発行</span>
                                        </td>
                                        <td class="px-6 py-4 text-gray-500">2024-01-20</td>
                                        <td class="px-6 py-4 text-right flex items-center justify-end gap-2">
                                            <button @click="openEditUserModal({name: '佐藤 花子', email: 'hanako.sato@example.com', plan: 'pro'})" class="text-indigo-600 hover:text-indigo-900 font-medium text-xs px-2 py-1 rounded hover:bg-indigo-50 transition-colors">
                                                編集
                                            </button>
                                            <button class="text-red-600 hover:text-red-900 font-medium text-xs px-2 py-1 rounded hover:bg-red-50 transition-colors">
                                                削除
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <!-- ▲▲▲ Section 2 End ▲▲▲ -->

                    <!-- ▼▼▼ Section 3: Danger Zone (危険エリア) ▼▼▼ -->
                    <!-- ※ APIキー管理はユーザー編集モーダル内に移動しました -->
                    <div class="border border-red-200 rounded-xl overflow-hidden">
                        <div class="px-6 py-4 bg-red-50 flex items-center justify-between">
                            <h2 class="text-sm font-bold text-red-800">危険な操作エリア</h2>
                        </div>
                        <div class="p-6 bg-white flex items-center justify-between">
                            <div>
                                <h3 class="text-sm font-medium text-gray-900">チームの削除</h3>
                                <p class="text-xs text-gray-500 mt-1">このチームとそのすべての利用データを完全に削除します。</p>
                            </div>
                            <button class="px-4 py-2 border border-red-300 text-red-700 rounded-lg text-sm hover:bg-red-50 font-medium">削除する</button>
                        </div>
                    </div>
                    <!-- ▲▲▲ Section 3 End ▲▲▲ -->

                </div>

            </main>
        </div>
    </div>

    <!--
    ============================================================================
    ▼▼▼ Component: User Add Modal (新規ユーザー追加モーダル) ▼▼▼

    [概要]
    新規ユーザーを追加するためのポップアップウィンドウ。
    x-show="addUserModalOpen" で表示/非表示を制御。

    [構成要素]
    1. Overlay (背景): bg-gray-500, クリックで閉じる
    2. Modal Panel (本体): bg-white, 中央配置
    3. Form Content: 名前、Email、パスワード、契約プラン、APIキー（自動生成）
    4. Action Buttons: 追加/キャンセル

    [設計変更点]
    - プランはユーザー単位のため追加モーダルで設定
    - APIキー（user_api_keys）もユーザー追加時に発行
    ============================================================================
    -->
    <div x-show="addUserModalOpen" class="fixed inset-0 z-50 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true" x-cloak>
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <!-- 1. Overlay Background -->
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" @click="addUserModalOpen = false" x-transition.opacity></div>

            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

            <!-- 2. Modal Panel -->
            <div class="inline-block align-bottom bg-white rounded-xl text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"
                 x-transition:enter="ease-out duration-300"
                 x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                 x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
                 x-transition:leave="ease-in duration-200"
                 x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
                 x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95">

                <!-- 3. Form Content -->
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-indigo-100 sm:mx-0 sm:h-10 sm:w-10">
                            <i class="fas fa-user-plus text-indigo-600"></i>
                        </div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                            <h3 class="text-lg leading-6 font-medium text-gray-900">新規ユーザー追加</h3>
                            <div class="mt-4 space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">お名前 <span class="text-red-500">*</span></label>
                                    <input type="text" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm border py-2 px-3" placeholder="例: 山田 太郎">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700">メールアドレス <span class="text-red-500">*</span></label>
                                    <input type="email" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm border py-2 px-3" placeholder="例: taro.yamada@example.com">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700">初期パスワード <span class="text-red-500">*</span></label>
                                    <input type="password" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm border py-2 px-3" placeholder="例: Admin@2024">
                                    <p class="text-xs text-gray-500 mt-1">※10文字以上、小文字・大文字・数字・記号を全て含めてください。</p>
                                </div>

                                <!-- 契約プラン (ユーザー単位) -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">契約プラン <span class="text-red-500">*</span></label>
                                    <select class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm border py-2 px-3 bg-white">
                                        <option value="light">Light Plan (30k req/mo)</option>
                                        <option value="standard" selected>Standard Plan (100k req/mo)</option>
                                        <option value="pro">Pro Plan (500k req/mo)</option>
                                    </select>
                                    <p class="mt-1 text-xs text-gray-500">※プランはユーザー個別に設定されます。</p>
                                </div>

                                <!-- APIキー (user_api_keys) 自動生成 -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">接続用APIキー</label>
                                    <div class="mt-1 flex rounded-md shadow-sm">
                                        <div class="relative flex-grow focus-within:z-10">
                                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                                <i class="fas fa-key text-gray-400"></i>
                                            </div>
                                            <input type="text" x-model="newUserApiKey" readonly
                                                   class="focus:ring-indigo-500 focus:border-indigo-500 block w-full rounded-none rounded-l-md pl-10 sm:text-sm border border-gray-300 bg-gray-50 font-mono text-gray-600 cursor-not-allowed py-2">
                                        </div>
                                        <button @click="generateNewUserApiKey()" type="button"
                                                class="-ml-px relative inline-flex items-center space-x-2 px-4 py-2 border border-gray-300 text-sm font-medium rounded-r-md text-gray-700 bg-gray-50 hover:bg-gray-100 focus:outline-none focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500">
                                            <i class="fas fa-sync-alt text-gray-500"></i>
                                            <span>生成</span>
                                        </button>
                                    </div>
                                    <p class="mt-1 text-xs text-gray-500">※「生成」ボタンでAPIキーを発行します。空白のままでも後で発行できます。</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 4. Action Buttons -->
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button @click="addUserModalOpen = false" type="button" class="w-full inline-flex justify-center rounded-lg border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm">
                        追加する
                    </button>
                    <button @click="addUserModalOpen = false" type="button" class="mt-3 w-full inline-flex justify-center rounded-lg border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        キャンセル
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- ▲▲▲ User Add Modal End ▲▲▲ -->

    <!--
    ============================================================================
    ▼▼▼ Component: User Edit Modal (ユーザー編集モーダル) ▼▼▼

    [概要]
    既存ユーザーの情報を編集するためのポップアップウィンドウ。
    x-show="userModalOpen" で表示/非表示を制御。
    currentUser 変数にバインドされたデータをフォームに展開する。

    [設計変更点]
    - プラン変更をモーダル内で設定（ユーザー単位）
    - APIキー管理（マスク表示/表示/コピー/再発行）をモーダル内に追加
    ============================================================================
    -->
    <div x-show="userModalOpen" class="fixed inset-0 z-50 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true" x-cloak>
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <!-- Overlay -->
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" @click="userModalOpen = false" x-transition.opacity></div>

            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

            <!-- Modal Panel -->
            <div class="inline-block align-bottom bg-white rounded-xl text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"
                 x-transition:enter="ease-out duration-300"
                 x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                 x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
                 x-transition:leave="ease-in duration-200"
                 x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
                 x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95">

                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-indigo-100 sm:mx-0 sm:h-10 sm:w-10">
                            <i class="fas fa-user-edit text-indigo-600"></i>
                        </div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                            <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">ユーザー情報の編集</h3>
                            <div class="mt-4 space-y-4">
                                <div>
                                    <label for="edit-name" class="block text-sm font-medium text-gray-700">お名前</label>
                                    <input type="text" id="edit-name" :value="currentUser.name || ''" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm border py-2 px-3">
                                </div>

                                <div>
                                    <label for="edit-email" class="block text-sm font-medium text-gray-700">メールアドレス</label>
                                    <input type="email" id="edit-email" :value="currentUser.email || ''" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm border py-2 px-3">
                                </div>

                                <!-- 契約プラン (ユーザー単位) -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">契約プラン</label>
                                    <select class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm border py-2 px-3 bg-white"
                                            :value="currentUser.plan || 'standard'">
                                        <option value="light">Light Plan (30k req/mo)</option>
                                        <option value="standard">Standard Plan (100k req/mo)</option>
                                        <option value="pro">Pro Plan (500k req/mo)</option>
                                    </select>
                                    <p class="mt-1 text-xs text-gray-500">※プラン変更は即時適用されます。</p>
                                </div>

                                <!-- APIキー管理 (user_api_keys) -->
                                <div class="pt-2 border-t border-gray-100">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-key text-gray-400 mr-1"></i> 接続用APIキー管理
                                    </label>
                                    <div class="relative">
                                        <div class="flex items-center border rounded-lg overflow-hidden bg-gray-50 border-gray-300">
                                            <div class="flex-1 px-3 py-2 font-mono text-xs text-gray-700 tracking-wider overflow-x-auto whitespace-nowrap"
                                                 :class="editUserShowApiKey ? 'bg-white' : 'bg-gray-100 text-gray-500'">
                                                <span x-text="editUserShowApiKey ? editUserDisplayValue : 'uak_********************'"></span>
                                            </div>
                                            <div class="flex items-center border-l border-gray-300 bg-white flex-shrink-0">
                                                <button x-show="editUserShowApiKey"
                                                        class="px-3 py-2 text-gray-500 hover:text-indigo-600 hover:bg-gray-50 transition-colors border-r border-gray-300"
                                                        title="コピー">
                                                    <i class="far fa-copy text-xs"></i>
                                                </button>
                                                <button x-show="!editUserShowApiKey" @click="revealEditUserKey()"
                                                        class="px-3 py-2 text-xs font-medium text-indigo-600 hover:text-indigo-800 hover:bg-indigo-50 transition-colors flex items-center gap-1 border-r border-gray-300">
                                                    <i class="fas fa-circle-notch fa-spin" x-show="editUserLoading"></i>
                                                    <i class="far fa-eye" x-show="!editUserLoading"></i>
                                                    <span>表示</span>
                                                </button>
                                                <button @click="editUserApiKeyModalOpen = true"
                                                        class="px-3 py-2 text-xs font-medium text-red-600 hover:text-red-800 hover:bg-red-50 transition-colors">
                                                    <i class="fas fa-sync-alt"></i> 再発行
                                                </button>
                                            </div>
                                        </div>
                                        <div x-show="editUserLoading" class="absolute inset-0 bg-white/50 z-10 cursor-wait"></div>
                                    </div>
                                    <p class="mt-1 text-xs text-gray-400 text-right">最終利用: 2023-10-25 14:30</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button @click="userModalOpen = false" type="button" class="w-full inline-flex justify-center rounded-lg border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm">
                        保存する
                    </button>
                    <button @click="userModalOpen = false" type="button" class="mt-3 w-full inline-flex justify-center rounded-lg border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        キャンセル
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- ▲▲▲ User Edit Modal End ▲▲▲ -->

    <!--
    ============================================================================
    ▼▼▼ Component: API Key Regenerate Confirm Modal (APIキー再発行確認モーダル) ▼▼▼
    ユーザー編集モーダル内のAPIキー再発行確認用。グローバル管理。
    ============================================================================
    -->
    <div x-show="editUserApiKeyModalOpen" class="fixed inset-0 z-[60] overflow-y-auto" aria-labelledby="apikey-modal-title" role="dialog" aria-modal="true" x-cloak>
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" @click="editUserApiKeyModalOpen = false"></div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-md sm:w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">
                            <i class="fas fa-exclamation-triangle text-red-600"></i>
                        </div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                            <h3 class="text-lg leading-6 font-medium text-gray-900" id="apikey-modal-title">APIキーを再発行しますか？</h3>
                            <div class="mt-2">
                                <p class="text-sm text-gray-500">
                                    現在のAPIキーは直ちに無効化され、新しいキーが生成されます。<br>
                                    <strong>オンプレミス側の設定変更が必要になります。</strong>この操作は元に戻せません。
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button @click="regenerateEditUserKey()" type="button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm">
                        再発行する
                    </button>
                    <button @click="editUserApiKeyModalOpen = false" type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        キャンセル
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- ▲▲▲ API Key Regenerate Confirm Modal End ▲▲▲ -->

</body>
</html>

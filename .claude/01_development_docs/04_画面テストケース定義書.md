# 画面テストケース定義書

## 1. 概要

### 1.1 ドキュメントの目的

本ドキュメントは、rasinban-ai-studioプロジェクトにおける **画面単位（Feature Test）** の受入条件とテストケースを定義します。

### 1.2 対象範囲

- **対象画面:** 管理者エリア（A01-A09）、一般ユーザーエリア（U01）、共通画面（G01）
- **テストアプローチ:** Feature Test（統合テスト）+ E2Eシナリオテスト
- **テスト対象:**
  - ページの表示・レンダリング
  - データの取得・表示
  - フォーム送信・バリデーション
  - 認証・認可
  - 画面遷移
  - Livewireインタラクション
  - データベース操作
  - ビジネスロジック

- **テスト対象外:**
  - ブラウザの詳細なUI/UXテスト（Duskで将来対応）
  - パフォーマンステスト
  - セキュリティ脆弱性スキャン

### 1.3 総テストケース数

- **総ケース数:** 約120-150ケース（各画面10-15ケース）
- **優先度別内訳:**
  - **High:** 約70ケース（主要機能、クリティカルパス）
  - **Medium:** 約40ケース（サブ機能、エッジケース）
  - **Low:** 約10-15ケース（将来的な対応）

### 1.4 コンポーネントテストとの関係

- **コンポーネントテスト（03_テストケース定義書.md）:** UI部品単体の動作検証
- **画面テスト（本ドキュメント）:** ビジネスロジック、データフロー、画面全体の統合検証

両方のテストが必要で、相互に補完関係にあります。

---

## 2. テスト戦略

### 2.1 テストアプローチ

各画面に対して **Feature Test（統合テスト）** を実施します。

#### テスト種別

1. **認証・認可テスト**
   - ログイン状態の検証
   - 管理者/一般ユーザーの権限検証
   - 未認証時のリダイレクト

2. **ページ表示テスト**
   - HTTPステータス200の確認
   - 必須要素の表示確認
   - データの正しい表示

3. **データ操作テスト（CRUD）**
   - Create: フォーム送信、データ登録
   - Read: データ取得、一覧表示
   - Update: データ更新、バリデーション
   - Delete: データ削除、確認モーダル

4. **検索・フィルタテスト**
   - 検索機能の動作
   - フィルタの適用
   - ページネーション

5. **Livewireインタラクションテスト**
   - リアルタイム検索
   - モーダル開閉
   - 状態変更

6. **ビジネスロジックテスト**
   - APIキー生成
   - 利用回数制限
   - 月次集計

### 2.2 優先度付け

| 優先度 | 条件 | 実装タイミング |
|--------|------|--------------|
| **High** | 主要機能、ユーザーが頻繁に使用、データ整合性が重要 | Phase 1（Week 1-3） |
| **Medium** | サブ機能、エラーハンドリング、エッジケース | Phase 2（Week 4-6） |
| **Low** | 将来的な拡張、詳細な検証 | Phase 3（Week 7-8） |

### 2.3 実装フロー

1. **Phase 1（High優先度）:** A01, A02, A03, A05（基本CRUD画面）
2. **Phase 2（Medium優先度）:** A04, A06, A07, A09（特殊機能画面）
3. **Phase 3（Low優先度）:** A08, U01, G01（モーダル、一般ユーザー、ログイン）

---

## 3. テスト環境

### 3.1 テストフレームワーク

- **PHPUnit:** 11.5.3
- **Laravel Testing:** Laravel 12.x Testing Utilities
- **Livewire Testing:** Livewire 4.x組み込み
- **Database Testing:** RefreshDatabase trait

### 3.2 テスト実行コマンド

```bash
# 全画面テスト実行
vendor/bin/sail artisan test --compact tests/Feature/Screens

# 特定画面のみ実行
vendor/bin/sail artisan test --compact tests/Feature/Screens/A01AdminDashboardTest.php

# 特定テスト名でフィルタ
vendor/bin/sail artisan test --compact --filter=testCanViewDashboard
```

### 3.3 テストデータ準備

- **Seeders:** テスト用の基本データ（Plans, Users, Teams）
- **Factories:** 動的なテストデータ生成
- **RefreshDatabase:** 各テスト後にDBをリセット

---

## 4. 受入条件（Acceptance Criteria）

### 4.1 受入条件テンプレート

各画面の受入条件を以下のカテゴリに分けて定義：

1. **AC1: 認証・認可** - ログイン状態、権限検証
2. **AC2: ページ表示** - 基本表示、データ表示
3. **AC3: データ操作（CRUD）** - 登録、更新、削除
4. **AC4: 検索・フィルタ** - 検索機能、フィルタリング
5. **AC5: Livewireインタラクション** - リアルタイム更新、モーダル
6. **AC6: ビジネスロジック** - 計算、集計、バリデーション
7. **AC7: エラーハンドリング** - バリデーションエラー、例外処理

### 4.2 AC-IDの採番ルール

**形式:** `AC-{画面ID}-{カテゴリ番号}{連番}`

**カテゴリ番号:**
- 0xx: 認証・認可
- 1xx: ページ表示
- 2xx: データ操作（CRUD）
- 3xx: 検索・フィルタ
- 4xx: Livewireインタラクション
- 5xx: ビジネスロジック
- 6xx: エラーハンドリング

**例:** `AC-A01-001`, `AC-A02-101`, `AC-A03-201`

### 4.3 カテゴリ別受入条件

---

#### 4.3.1 A01: 管理者ダッシュボード

**概要:**
管理者がログイン後に最初にアクセスする画面。システム全体の稼働状況を俯瞰。URL: `/admin`

**受入条件:**

##### AC1: 認証・認可
- AC-A01-001: 未ログインユーザーがアクセスした場合、ログイン画面にリダイレクトされる【High】
- AC-A01-002: 一般ユーザー（is_admin=false）がアクセスした場合、403エラーが返される【High】
- AC-A01-003: 管理者ユーザー（is_admin=true）がアクセスした場合、ダッシュボードが表示される【High】

##### AC2: ページ表示
- AC-A01-101: KPIカードエリアに「契約拠点数」「今月の総リクエスト」「稼働Difyアプリ」が表示される【High】
- AC-A01-102: 契約拠点数に `teams.count()` の値が表示される【High】
- AC-A01-103: 今月の総リクエストに `monthly_api_usages.sum('count')` の値が表示される【High】
- AC-A01-104: 稼働Difyアプリに `dify_apps.where('is_active', true).count()` の値が表示される【High】
- AC-A01-105: 利用率の高い拠点一覧テーブルに上位5件が表示される【High】
- AC-A01-106: 各拠点の利用率がプログレスバーとパーセンテージで表示される【Medium】

##### AC3: データ操作
- AC-A01-201: 編集ボタンをクリックした場合、A03拠点編集画面（`/admin/teams/{id}`）へ遷移する【High】
- AC-A01-202: 「すべて見る」リンクをクリックした場合、A02拠点一覧画面（`/admin/teams`）へ遷移する【Medium】

##### AC5: ビジネスロジック
- AC-A01-501: 利用率の計算が正しい（`usage_count / usage_limit * 100`）【High】
- AC-A01-502: 利用率が90%以上の拠点のプログレスバーが赤色で表示される【Medium】

---

#### 4.3.2 A02: 拠点一覧

**概要:**
登録されている拠点（Team）の一覧表示、検索、新規作成を行う画面。URL: `/admin/teams`

**受入条件:**

##### AC1: 認証・認可
- AC-A02-001: 未ログインユーザーがアクセスした場合、ログイン画面にリダイレクトされる【High】
- AC-A02-002: 一般ユーザー（is_admin=false）がアクセスした場合、403エラーが返される【High】
- AC-A02-003: 管理者ユーザー（is_admin=true）がアクセスした場合、拠点一覧が表示される【High】

##### AC2: ページ表示
- AC-A02-101: 拠点一覧テーブルに全拠点が表示される（ページネーション: 50件/ページ）【High】
- AC-A02-102: 各拠点に「拠点名(+ID)」「プラン/利用率」「管理者」「最終アクセス」が表示される【High】
- AC-A02-103: 拠点名カラムに拠点名と`#team.id`がグレー表示される（例: 東京本社 営業部 #001）【High】
- AC-A02-104: プラン/利用率カラムにプラン名、今月利用数/上限、プログレスバーが表示される【High】
- AC-A02-105: 管理者カラムにオーナー名とメールアドレス（グレー表示）が表示される【High】
- AC-A02-106: 最終アクセスカラムに相対時刻が表示される（例: 2時間前、1日前）【Medium】
- AC-A02-107: 検索バー（拠点名、担当者名で検索、debounce 300ms）が表示される【High】
- AC-A02-108: 制限超過フィルタ（ToggleSwitch、ONで制限超過拠点のみ表示）が表示される【High】
- AC-A02-109: プランフィルタ（SelectInput: 全て/Light/Standard/Pro）が表示される【Medium】

##### AC3: データ操作（CRUD）
- AC-A02-201: 「新規作成」ボタンをクリックした場合、新規作成モーダルが表示される【High】
- AC-A02-202: モーダル表示時、拠点接続用APIキーが自動生成される（64文字のランダム文字列）【High】
- AC-A02-203: モーダルのAPIキー再生成ボタンをクリックした場合、新しいAPIキーが生成される【Medium】
- AC-A02-204: モーダルで拠点名、初期契約プラン、APIキー（自動生成済み）を確認して保存した場合、Teamと TeamApiKeyが作成される【High】
- AC-A02-205: モーダルでバリデーションエラーがある場合、エラーメッセージが表示される【High】
- AC-A02-206: 拠点作成後、モーダルが閉じ、一覧が更新される【High】
- AC-A02-207: 拠点名（セル）をクリックした場合、A03拠点編集画面（`/admin/teams/{id}`）へ遷移する【High】

##### AC4: 検索・フィルタ
- AC-A02-301: 検索バーに拠点名を入力した場合、部分一致で拠点が絞り込まれる（debounce 300ms、`wire:model.live.debounce.300ms`）【High】
- AC-A02-302: 検索バーに担当者名（オーナー名）を入力した場合、部分一致で拠点が絞り込まれる（debounce 300ms）【High】
- AC-A02-303: 制限超過フィルタ（ToggleSwitch）をONにした場合、`total_requests > plan_limits.monthly_limit` の拠点のみ表示される【High】
- AC-A02-304: プランフィルタ（SelectInput）を選択した場合、該当プランの拠点のみ表示される【High】
- AC-A02-305: 検索とフィルタを組み合わせた場合、AND条件で絞り込まれる【Medium】
- AC-A02-306: ページネーションをクリックした場合、次のページ（50件単位）が表示される【High】

##### AC5: Livewireインタラクション
- AC-A02-401: 検索入力中、debounce 300ms後にリアルタイムで一覧が更新される【High】
- AC-A02-402: 制限超過フィルタ（ToggleSwitch）をON/OFF切替した場合、即時フィルタリングが更新される【High】
- AC-A02-403: モーダルを開閉した場合、フォームがリセットされる【Medium】
- AC-A02-404: モーダルのAPIキー再生成ボタンをクリックした場合、`Str::random(64)` で新しいAPIキーが生成される【Medium】

##### AC6: ビジネスロジック
- AC-A02-501: 利用率100%超過の拠点のプログレスバーが赤色（`bg-red-600`）で表示される【High】
- AC-A02-502: 利用率90%以上の拠点のプログレスバーが黄色（`bg-yellow-500`）で表示される【Medium】
- AC-A02-503: 利用率90%未満の拠点のプログレスバーが青色（`bg-blue-500`）で表示される【Medium】
- AC-A02-504: APIキーは`Str::random(64)`で自動生成され、SHA-256ハッシュと暗号化で保存される【High】

##### AC7: エラーハンドリング
- AC-A02-601: 拠点名が空の場合、バリデーションエラーが表示される【High】
- AC-A02-602: プランが未選択の場合、バリデーションエラーが表示される【High】
- AC-A02-603: APIキーが未入力の場合、バリデーションエラーが表示される【High】

---

#### 4.3.3 A03: 拠点編集

**概要:**
拠点の詳細情報編集、所属ユーザー管理、APIキー管理、拠点削除を行う画面。URL: `/admin/teams/{id}`

**受入条件:**

##### AC1: 認証・認可
- AC-A03-001: 未ログインユーザーがアクセスした場合、ログイン画面にリダイレクトされる【High】
- AC-A03-002: 一般ユーザー（is_admin=false）がアクセスした場合、403エラーが返される【High】
- AC-A03-003: 管理者ユーザー（is_admin=true）がアクセスした場合、拠点編集画面が表示される【High】

##### AC2: ページ表示
- AC-A03-101: パンくずナビゲーション「拠点・ユーザー管理 > {拠点名}」が表示される【Medium】
- AC-A03-102: 基本情報セクションに拠点名、プラン、ステータスが表示される【High】
- AC-A03-103: 所属ユーザー一覧セクションに全ユーザーが表示される【High】
- AC-A03-104: APIキー管理セクションに現在のAPIキー（マスク表示）が表示される【High】
- AC-A03-105: Danger Zoneに拠点削除ボタンが表示される【High】

##### AC3: データ操作（CRUD）
- AC-A03-201: 基本情報を変更して保存ボタンをクリックした場合、拠点情報が更新される【High】
- AC-A03-202: 拠点情報更新後、成功トーストが表示される【Medium】
- AC-A03-203: ユーザー招待ボタンをクリックした場合、招待モーダルが表示される【High】
- AC-A03-204: 招待モーダルでメールアドレスと名前を入力して送信した場合、新規ユーザーが作成され、拠点に紐付けられる【High】
- AC-A03-205: ユーザー削除ボタンをクリックした場合、確認モーダルが表示される【High】
- AC-A03-206: 確認モーダルで削除を実行した場合、ユーザーが拠点から削除される（Ownerは削除不可）【High】
- AC-A03-207: APIキー再生成ボタンをクリックした場合、確認モーダルが表示される【High】
- AC-A03-208: 確認モーダルでAPIキー再生成を実行した場合、新規APIキーが発行され、平文で表示される【High】
- AC-A03-209: 拠点削除ボタンをクリックした場合、削除確認モーダル（拠点名入力必須）が表示される【High】
- AC-A03-210: 削除確認モーダルで拠点名を正しく入力して削除した場合、拠点が削除され、A02へリダイレクトされる【High】

##### AC4: Livewireインタラクション
- AC-A03-401: APIキー表示ボタンをクリックした場合、マスクが解除され、APIキーが表示される【High】
- AC-A03-402: APIキーコピーボタンをクリックした場合、APIキーがクリップボードにコピーされる【High】
- AC-A03-403: ステータスToggleSwitchを切り替えた場合、拠点のステータスが変更される【Medium】

##### AC5: ビジネスロジック
- AC-A03-501: APIキー再生成時、古いAPIキーは無効化される【High】
- AC-A03-502: APIキーはSHA-256ハッシュと暗号化の両方で保存される【High】
- AC-A03-503: Ownerユーザーは削除できない【High】

##### AC6: エラーハンドリング
- AC-A03-601: 拠点名が空の場合、バリデーションエラーが表示される【High】
- AC-A03-602: 削除確認モーダルで拠点名が一致しない場合、削除ボタンが無効化される【High】
- AC-A03-603: 招待メールが重複している場合、エラーメッセージが表示される【High】

---

#### 4.3.4 A04: CSV一括登録

**概要:**
CSVファイルをアップロードして拠点を一括登録する画面。URL: `/admin/teams/import`

**受入条件:**

##### AC1: 認証・認可
- AC-A04-001: 未ログインユーザーがアクセスした場合、ログイン画面にリダイレクトされる【High】
- AC-A04-002: 一般ユーザー（is_admin=false）がアクセスした場合、403エラーが返される【High】
- AC-A04-003: 管理者ユーザー（is_admin=true）がアクセスした場合、CSV一括登録画面が表示される【High】

##### AC2: ページ表示
- AC-A04-101: FileDropzoneエリアが表示される【High】
- AC-A04-102: ファイル選択後、プレビューテーブルが表示される【High】
- AC-A04-103: インポート進行中、プログレスバーとログコンソールが表示される【High】

##### AC3: データ操作
- AC-A04-201: CSVファイルをアップロードした場合、プレビューが表示される【High】
- AC-A04-202: 「インポート開始」ボタンをクリックした場合、拠点とユーザーが一括作成される【High】
- AC-A04-203: インポート完了後、成功件数とエラー件数が表示される【High】
- AC-A04-204: インポート完了後、A02へ遷移するリンクが表示される【Medium】

##### AC4: バリデーション
- AC-A04-301: CSV形式以外のファイルをアップロードした場合、エラーメッセージが表示される【High】
- AC-A04-302: 10MBを超えるファイルをアップロードした場合、エラーメッセージが表示される【High】
- AC-A04-303: CSVの列数が不正な場合、エラーメッセージが表示される【High】
- AC-A04-304: 必須項目が空の行がある場合、該当行のエラーがログに表示される【High】

##### AC5: ビジネスロジック
- AC-A04-501: 重複するメールアドレスの行はスキップされ、エラーログに記録される【High】
- AC-A04-502: インポート中、プログレスバーが進行状況を表示する【Medium】
- AC-A04-503: インポート中、ログコンソールにリアルタイムでログが表示される【Medium】

---

#### 4.3.5 A05: Difyアプリ一覧

**概要:**
Difyアプリの一覧表示、検索、新規登録を行う画面。URL: `/admin/apps`

**受入条件:**

##### AC1: 認証・認可
- AC-A05-001: 未ログインユーザーがアクセスした場合、ログイン画面にリダイレクトされる【High】
- AC-A05-002: 一般ユーザー（is_admin=false）がアクセスした場合、403エラーが返される【High】
- AC-A05-003: 管理者ユーザー（is_admin=true）がアクセスした場合、Difyアプリ一覧が表示される【High】

##### AC2: ページ表示
- AC-A05-101: Difyアプリ一覧テーブルに全アプリが表示される（ページネーション: 50件/ページ）【High】
- AC-A05-102: 各アプリに「アプリ名」「Slug」「ステータス」「操作」が表示される【High】
- AC-A05-103: 検索バーが表示される【High】

##### AC3: データ操作（CRUD）
- AC-A05-201: 「新規登録」ボタンをクリックした場合、新規登録モーダルが表示される【High】
- AC-A05-202: モーダルでアプリ名、Slug、Dify APIキーを入力して保存した場合、アプリが作成される【High】
- AC-A05-203: アプリ作成後、モーダルが閉じ、一覧が更新される【High】
- AC-A05-204: 編集ボタンをクリックした場合、A06アプリ編集画面へ遷移する【High】

##### AC4: 検索・フィルタ
- AC-A05-301: 検索バーにアプリ名を入力した場合、部分一致でアプリが絞り込まれる（デバウンス300ms）【High】
- AC-A05-302: ステータスフィルタを選択した場合、該当ステータスのアプリのみ表示される【High】

##### AC5: Livewireインタラクション
- AC-A05-401: ToggleSwitchをクリックした場合、アプリのステータスが即座に変更される【High】
- AC-A05-402: ステータス変更時、リロードせずに一覧が更新される【Medium】

##### AC6: ビジネスロジック
- AC-A05-501: Dify APIキーは暗号化されて保存される【High】
- AC-A05-502: Slugは一意でなければならない【High】

##### AC7: エラーハンドリング
- AC-A05-601: Slugが重複している場合、バリデーションエラーが表示される【High】
- AC-A05-602: Dify APIキーが空の場合、バリデーションエラーが表示される【High】

---

#### 4.3.6 A06: Difyアプリ編集

**概要:**
Difyアプリの詳細情報編集、削除を行う画面。URL: `/admin/apps/{id}`

**受入条件:**

##### AC1: 認証・認可
- AC-A06-001: 未ログインユーザーがアクセスした場合、ログイン画面にリダイレクトされる【High】
- AC-A06-002: 一般ユーザー（is_admin=false）がアクセスした場合、403エラーが返される【High】
- AC-A06-003: 管理者ユーザー（is_admin=true）がアクセスした場合、アプリ編集画面が表示される【High】

##### AC2: ページ表示
- AC-A06-101: パンくずナビゲーション「Difyアプリ管理 > {アプリ名}」が表示される【Medium】
- AC-A06-102: 基本情報セクションにアプリ名、Slug、ステータスが表示される【High】
- AC-A06-103: Dify APIキー（マスク表示）が表示される【High】
- AC-A06-104: Danger Zoneにアプリ削除ボタンが表示される【High】

##### AC3: データ操作（CRUD）
- AC-A06-201: 基本情報を変更して保存ボタンをクリックした場合、アプリ情報が更新される【High】
- AC-A06-202: アプリ削除ボタンをクリックした場合、削除確認モーダルが表示される【High】
- AC-A06-203: 削除確認モーダルで削除を実行した場合、アプリが削除され、A05へリダイレクトされる【High】

##### AC4: Livewireインタラクション
- AC-A06-401: Dify APIキー表示ボタンをクリックした場合、マスクが解除され、APIキーが表示される【High】
- AC-A06-402: ステータスToggleSwitchを切り替えた場合、アプリのステータスが変更される【Medium】

##### AC5: ビジネスロジック
- AC-A06-501: Slugは変更不可（disabled）【High】
- AC-A06-502: アプリ削除時、関連する利用実績データは保持される【Medium】

---

#### 4.3.7 A07: 利用状況一覧

**概要:**
月次利用実績の検索・一覧表示を行う画面。URL: `/admin/usages`

**受入条件:**

##### AC1: 認証・認可
- AC-A07-001: 未ログインユーザーがアクセスした場合、ログイン画面にリダイレクトされる【High】
- AC-A07-002: 一般ユーザー（is_admin=false）がアクセスした場合、403エラーが返される【High】
- AC-A07-003: 管理者ユーザー（is_admin=true）がアクセスした場合、利用状況一覧が表示される【High】

##### AC2: ページ表示
- AC-A07-101: 利用状況一覧テーブルに全レコードが表示される（ページネーション: 50件/ページ）【High】
- AC-A07-102: 各レコードに「拠点名」「アプリ名」「対象月」「利用回数」「上限」「利用率」「操作」が表示される【High】
- AC-A07-103: 検索バーと対象月フィルタが表示される【High】

##### AC3: データ操作
- AC-A07-201: 修正ボタンをクリックした場合、A08利用回数修正モーダルが表示される【High】

##### AC4: 検索・フィルタ
- AC-A07-301: 検索バーに拠点名を入力した場合、部分一致でレコードが絞り込まれる【High】
- AC-A07-302: 対象月フィルタを選択した場合、該当月のレコードのみ表示される【High】
- AC-A07-303: 検索と対象月フィルタを組み合わせた場合、AND条件で絞り込まれる【Medium】

##### AC5: ビジネスロジック
- AC-A07-501: 利用率が90%以上のレコードの行が赤色で強調表示される【Medium】
- AC-A07-502: 利用率が100%を超えるレコードの利用回数が赤色で表示される【High】

---

#### 4.3.8 A08: 利用回数修正（モーダル）

**概要:**
利用回数の手動修正を行うモーダル。A07から呼び出される。

**受入条件:**

##### AC1: ページ表示
- AC-A08-101: モーダルに拠点名、アプリ名、対象月が表示される【High】
- AC-A08-102: 現在の利用回数と上限が表示される【High】
- AC-A08-103: 新しい利用回数入力フィールドが表示される【High】
- AC-A08-104: 修正理由のテキストエリアが表示される【High】

##### AC2: データ操作
- AC-A08-201: 新しい利用回数と修正理由を入力して保存ボタンをクリックした場合、利用回数が更新される【High】
- AC-A08-202: 更新後、モーダルが閉じ、A07の一覧が更新される【High】

##### AC3: バリデーション
- AC-A08-301: 新しい利用回数が0未満の場合、バリデーションエラーが表示される【High】
- AC-A08-302: 修正理由が空の場合、バリデーションエラーが表示される【High】

##### AC4: ビジネスロジック
- AC-A08-401: 修正履歴が記録される（誰が、いつ、なぜ修正したか）【Medium】

---

#### 4.3.9 A09: 災害復旧エクスポート

**概要:**
災害復旧用のJSONデータをエクスポートする画面。URL: `/admin/dr/export`

**受入条件:**

##### AC1: 認証・認可
- AC-A09-001: 未ログインユーザーがアクセスした場合、ログイン画面にリダイレクトされる【High】
- AC-A09-002: 一般ユーザー（is_admin=false）がアクセスした場合、403エラーが返される【High】
- AC-A09-003: 管理者ユーザー（is_admin=true）がアクセスした場合、エクスポート画面が表示される【High】

##### AC2: ページ表示
- AC-A09-101: 警告バナー（AlertBanner type="warning"）が表示される【High】
- AC-A09-102: エクスポート対象のチェックボックスリストが表示される（Teams, Users, DifyApps等）【High】

##### AC3: データ操作
- AC-A09-201: 「エクスポート開始」ボタンをクリックした場合、JSONファイルが生成される【High】
- AC-A09-202: エクスポート完了後、ダウンロードボタンが表示される【High】
- AC-A09-203: ダウンロードボタンをクリックした場合、JSONファイルがダウンロードされる【High】

##### AC4: ビジネスロジック
- AC-A09-401: エクスポートされるJSONには選択したデータのみが含まれる【High】
- AC-A09-402: APIキーは暗号化された状態でエクスポートされる【High】
- AC-A09-403: エクスポート履歴が記録される（誰が、いつエクスポートしたか）【Medium】

---

#### 4.3.10 U01: 拠点ダッシュボード（一般ユーザー）

**概要:**
一般ユーザーが自チームの利用状況を確認する画面。URL: `/dashboard`

**受入条件:**

##### AC1: 認証・認可
- AC-U01-001: 未ログインユーザーがアクセスした場合、ログイン画面にリダイレクトされる【High】
- AC-U01-002: 一般ユーザーがアクセスした場合、自チームのダッシュボードが表示される【High】
- AC-U01-003: 管理者ユーザーがアクセスした場合、A01へリダイレクトされる【Medium】

##### AC2: ページ表示
- AC-U01-101: 自チームの今月の利用状況（利用回数、上限、利用率）が表示される【High】
- AC-U01-102: 利用率がプログレスバーで表示される【High】
- AC-U01-103: アプリ別利用状況テーブルが表示される【High】

##### AC3: アクセス制限
- AC-U01-301: 他チームのデータは表示されない【High】
- AC-U01-302: データの編集・削除ボタンは表示されない（閲覧のみ）【High】

---

#### 4.3.11 G01: ログイン

**概要:**
Jetstream標準のログイン画面。URL: `/login`

**受入条件:**

##### AC1: 認証
- AC-G01-001: 正しいメールアドレスとパスワードを入力してログインした場合、ダッシュボードへリダイレクトされる【High】
- AC-G01-002: 管理者ユーザーがログインした場合、A01へリダイレクトされる【High】
- AC-G01-003: 一般ユーザーがログインした場合、U01へリダイレクトされる【High】
- AC-G01-004: メールアドレスまたはパスワードが間違っている場合、エラーメッセージが表示される【High】

##### AC2: バリデーション
- AC-G01-201: メールアドレスが空の場合、バリデーションエラーが表示される【High】
- AC-G01-202: パスワードが空の場合、バリデーションエラーが表示される【High】

---

## 5. テストケース一覧

### 5.1 テストケース表フォーマット

各テストケースは以下の形式で記載します：

| テストID | テスト項目 | 前提条件 | 入力/操作 | 期待値 | 優先度 | 実装状況 | 対応AC |
|---------|---------|---------|---------|--------|--------|--------|--------|
| TC-A01-001 | ... | - | ... | ... | High | pending | AC-A01-001 |

---

### 5.2 画面別テストケース

---

#### 5.2.1 A01: 管理者ダッシュボード

**テストケース:**

| テストID | テスト項目 | 前提条件 | 入力/操作 | 期待値 | 優先度 | 実装状況 | 対応AC |
|---------|---------|---------|---------|--------|--------|--------|--------|
| TC-A01-001 | 未ログインでのアクセス | 未ログイン | `/admin` へGETリクエスト | `/login` へリダイレクト | High | pending | AC-A01-001 |
| TC-A01-002 | 一般ユーザーでのアクセス | 一般ユーザーでログイン | `/admin` へGETリクエスト | 403エラー | High | pending | AC-A01-002 |
| TC-A01-003 | 管理者でのアクセス | 管理者でログイン | `/admin` へGETリクエスト | 200ステータス、ダッシュボード表示 | High | pending | AC-A01-003 |
| TC-A01-004 | KPIカード表示 | 管理者でログイン、テストデータあり | ダッシュボードを表示 | 契約拠点数、総リクエスト、稼働アプリが表示される | High | pending | AC-A01-101 |
| TC-A01-005 | 契約拠点数の表示 | 管理者でログイン、5拠点存在 | ダッシュボードを表示 | 契約拠点数に「5」が表示される | High | pending | AC-A01-102 |
| TC-A01-006 | 今月の総リクエスト表示 | 管理者でログイン、今月の利用実績あり | ダッシュボードを表示 | 今月の総リクエスト数が表示される | High | pending | AC-A01-103 |
| TC-A01-007 | 稼働Difyアプリ表示 | 管理者でログイン、アクティブアプリ3件 | ダッシュボードを表示 | 稼働Difyアプリに「3」が表示される | High | pending | AC-A01-104 |
| TC-A01-008 | 利用率上位5件表示 | 管理者でログイン、10拠点存在 | ダッシュボードを表示 | 利用率の高い上位5拠点のみ表示される | High | pending | AC-A01-105 |
| TC-A01-009 | 利用率プログレスバー表示 | 管理者でログイン、利用率75%の拠点あり | ダッシュボードを表示 | プログレスバーが75%で表示される | Medium | pending | AC-A01-106 |
| TC-A01-010 | 編集ボタンクリック | 管理者でログイン | 拠点の編集ボタンをクリック | `/admin/teams/{id}` へ遷移 | High | pending | AC-A01-201 |
| TC-A01-011 | すべて見るリンククリック | 管理者でログイン | 「すべて見る」リンクをクリック | `/admin/teams` へ遷移 | Medium | pending | AC-A01-202 |
| TC-A01-012 | 利用率90%以上の表示 | 管理者でログイン、利用率95%の拠点あり | ダッシュボードを表示 | プログレスバーが赤色で表示される | Medium | pending | AC-A01-502 |

---

#### 5.2.2 A02: 拠点一覧

**テストケース:**

| テストID | テスト項目 | 前提条件 | 入力/操作 | 期待値 | 優先度 | 実装状況 | 対応AC |
|---------|---------|---------|---------|--------|--------|--------|--------|
| TC-A02-001 | 未ログインでのアクセス | 未ログイン | `/admin/teams` へGETリクエスト | `/login` へリダイレクト | High | pending | AC-A02-001 |
| TC-A02-002 | 管理者でのアクセス | 管理者でログイン | `/admin/teams` へGETリクエスト | 200ステータス、拠点一覧表示 | High | pending | AC-A02-002 |
| TC-A02-003 | 拠点一覧表示 | 管理者でログイン、15拠点存在 | 拠点一覧を表示 | 最初の10件が表示される | High | pending | AC-A02-101 |
| TC-A02-004 | 拠点詳細情報表示 | 管理者でログイン、拠点あり | 拠点一覧を表示 | 拠点名、プラン、ユーザー数、今月利用、ステータス、操作が表示される | High | pending | AC-A02-102 |
| TC-A02-005 | 新規作成ボタンクリック | 管理者でログイン | 「新規作成」ボタンをクリック | 新規作成モーダルが表示される | High | pending | AC-A02-201 |
| TC-A02-006 | 拠点新規作成 | モーダル表示中 | 拠点名、プラン、オーナーメール、オーナー名を入力して保存 | 拠点とオーナーが作成され、一覧が更新される | High | pending | AC-A02-202 |
| TC-A02-007 | バリデーションエラー | モーダル表示中 | 拠点名を空で保存 | バリデーションエラーが表示される | High | pending | AC-A02-601 |
| TC-A02-008 | 検索機能 | 管理者でログイン、10拠点存在 | 検索バーに「東京」と入力 | 「東京」を含む拠点のみ表示される | High | pending | AC-A02-301 |
| TC-A02-009 | プランフィルタ | 管理者でログイン、複数プランの拠点あり | プランフィルタで「Standard」を選択 | Standardプランの拠点のみ表示される | High | pending | AC-A02-302 |
| TC-A02-010 | ステータスフィルタ | 管理者でログイン、アクティブ/非アクティブ拠点あり | ステータスフィルタで「Active」を選択 | アクティブな拠点のみ表示される | High | pending | AC-A02-303 |
| TC-A02-011 | 検索とフィルタの組み合わせ | 管理者でログイン | 検索「東京」+ プラン「Standard」 | 両条件を満たす拠点のみ表示される | Medium | pending | AC-A02-304 |
| TC-A02-012 | ページネーション | 管理者でログイン、15拠点存在 | ページ2をクリック | 11-15件目が表示される | High | pending | AC-A02-305 |
| TC-A02-013 | オーナーメール重複エラー | モーダル表示中 | 既存のメールアドレスで拠点作成 | 「メールアドレスが既に使用されています」エラー | High | pending | AC-A02-602 |

---

#### 5.2.3 A03: 拠点編集

**テストケース:**

| テストID | テスト項目 | 前提条件 | 入力/操作 | 期待値 | 優先度 | 実装状況 | 対応AC |
|---------|---------|---------|---------|--------|--------|--------|--------|
| TC-A03-001 | 未ログインでのアクセス | 未ログイン | `/admin/teams/1` へGETリクエスト | `/login` へリダイレクト | High | pending | AC-A03-001 |
| TC-A03-002 | 管理者でのアクセス | 管理者でログイン、拠点ID=1 | `/admin/teams/1` へGETリクエスト | 200ステータス、拠点編集画面表示 | High | pending | AC-A03-002 |
| TC-A03-003 | 基本情報表示 | 管理者でログイン、拠点あり | 拠点編集画面を表示 | 拠点名、プラン、ステータスが表示される | High | pending | AC-A03-102 |
| TC-A03-004 | 所属ユーザー一覧表示 | 管理者でログイン、拠点に3ユーザー所属 | 拠点編集画面を表示 | 3ユーザーが表示される | High | pending | AC-A03-103 |
| TC-A03-005 | APIキー表示 | 管理者でログイン、拠点あり | 拠点編集画面を表示 | APIキーがマスク表示される | High | pending | AC-A03-104 |
| TC-A03-006 | 基本情報更新 | 管理者でログイン、拠点あり | 拠点名を変更して保存 | 拠点情報が更新され、成功トースト表示 | High | pending | AC-A03-201 |
| TC-A03-007 | ユーザー招待 | 管理者でログイン、拠点あり | ユーザー招待ボタンクリック、メールと名前入力 | 新規ユーザーが作成され、拠点に紐付けられる | High | pending | AC-A03-204 |
| TC-A03-008 | ユーザー削除 | 管理者でログイン、拠点に一般ユーザーあり | ユーザー削除ボタンクリック、確認 | ユーザーが拠点から削除される | High | pending | AC-A03-206 |
| TC-A03-009 | Owner削除不可 | 管理者でログイン、拠点あり | Ownerの削除ボタンをクリック | 削除ボタンが無効化されている | High | pending | AC-A03-503 |
| TC-A03-010 | APIキー表示ボタン | 管理者でログイン、拠点あり | APIキー表示ボタンをクリック | マスクが解除され、APIキーが表示される | High | pending | AC-A03-401 |
| TC-A03-011 | APIキーコピー | 管理者でログイン、拠点あり | APIキーコピーボタンをクリック | APIキーがクリップボードにコピーされる | High | pending | AC-A03-402 |
| TC-A03-012 | APIキー再生成 | 管理者でログイン、拠点あり | APIキー再生成ボタンクリック、確認 | 新規APIキーが発行され、平文で表示される | High | pending | AC-A03-208 |
| TC-A03-013 | 拠点削除 | 管理者でログイン、拠点あり | 拠点削除ボタンクリック、拠点名入力、確認 | 拠点が削除され、A02へリダイレクト | High | pending | AC-A03-210 |
| TC-A03-014 | 拠点削除時の入力検証 | 削除モーダル表示中 | 誤った拠点名を入力 | 削除ボタンが無効化される | High | pending | AC-A03-602 |

---

#### 5.2.4 A04: CSV一括登録

**テストケース:**

| テストID | テスト項目 | 前提条件 | 入力/操作 | 期待値 | 優先度 | 実装状況 | 対応AC |
|---------|---------|---------|---------|--------|--------|--------|--------|
| TC-A04-001 | 未ログインでのアクセス | 未ログイン | `/admin/teams/import` へGETリクエスト | `/login` へリダイレクト | High | pending | AC-A04-001 |
| TC-A04-002 | 管理者でのアクセス | 管理者でログイン | `/admin/teams/import` へGETリクエスト | 200ステータス、CSV一括登録画面表示 | High | pending | AC-A04-002 |
| TC-A04-003 | CSVアップロード | 管理者でログイン | 正しい形式のCSVをアップロード | プレビューテーブルが表示される | High | pending | AC-A04-201 |
| TC-A04-004 | インポート実行 | CSVアップロード済み | 「インポート開始」ボタンをクリック | 拠点とユーザーが一括作成される | High | pending | AC-A04-202 |
| TC-A04-005 | インポート完了表示 | インポート完了 | - | 成功件数とエラー件数が表示される | High | pending | AC-A04-203 |
| TC-A04-006 | CSV形式エラー | 管理者でログイン | TXTファイルをアップロード | エラーメッセージが表示される | High | pending | AC-A04-301 |
| TC-A04-007 | ファイルサイズエラー | 管理者でログイン | 10MB超過のCSVをアップロード | エラーメッセージが表示される | High | pending | AC-A04-302 |
| TC-A04-008 | CSV列数エラー | 管理者でログイン | 列数が不正なCSVをアップロード | エラーメッセージが表示される | High | pending | AC-A04-303 |
| TC-A04-009 | 必須項目エラー | 管理者でログイン | 拠点名が空の行があるCSVをアップロード | 該当行のエラーがログに表示される | High | pending | AC-A04-304 |
| TC-A04-010 | メール重複処理 | 管理者でログイン | 既存メールアドレスを含むCSVをアップロード | 重複行がスキップされ、エラーログに記録される | High | pending | AC-A04-501 |

---

#### 5.2.5 A05: Difyアプリ一覧

**テストケース:**

| テストID | テスト項目 | 前提条件 | 入力/操作 | 期待値 | 優先度 | 実装状況 | 対応AC |
|---------|---------|---------|---------|--------|--------|--------|--------|
| TC-A05-001 | 未ログインでのアクセス | 未ログイン | `/admin/apps` へGETリクエスト | `/login` へリダイレクト | High | pending | AC-A05-001 |
| TC-A05-002 | 管理者でのアクセス | 管理者でログイン | `/admin/apps` へGETリクエスト | 200ステータス、Difyアプリ一覧表示 | High | pending | AC-A05-002 |
| TC-A05-003 | アプリ一覧表示 | 管理者でログイン、15アプリ存在 | アプリ一覧を表示 | 最初の10件が表示される | High | pending | AC-A05-101 |
| TC-A05-004 | 新規登録ボタンクリック | 管理者でログイン | 「新規登録」ボタンをクリック | 新規登録モーダルが表示される | High | pending | AC-A05-201 |
| TC-A05-005 | アプリ新規作成 | モーダル表示中 | アプリ名、Slug、Dify APIキーを入力して保存 | アプリが作成され、一覧が更新される | High | pending | AC-A05-202 |
| TC-A05-006 | 検索機能 | 管理者でログイン、10アプリ存在 | 検索バーに「Chat」と入力 | 「Chat」を含むアプリのみ表示される | High | pending | AC-A05-301 |
| TC-A05-007 | ステータス切替 | 管理者でログイン、アプリあり | ToggleSwitchをクリック | アプリのステータスが即座に変更される | High | pending | AC-A05-401 |
| TC-A05-008 | Slug重複エラー | モーダル表示中 | 既存のSlugでアプリ作成 | バリデーションエラーが表示される | High | pending | AC-A05-601 |

---

#### 5.2.6 A06: Difyアプリ編集

**テストケース:**

| テストID | テスト項目 | 前提条件 | 入力/操作 | 期待値 | 優先度 | 実装状況 | 対応AC |
|---------|---------|---------|---------|--------|--------|--------|--------|
| TC-A06-001 | 未ログインでのアクセス | 未ログイン | `/admin/apps/1` へGETリクエスト | `/login` へリダイレクト | High | pending | AC-A06-001 |
| TC-A06-002 | 管理者でのアクセス | 管理者でログイン、アプリID=1 | `/admin/apps/1` へGETリクエスト | 200ステータス、アプリ編集画面表示 | High | pending | AC-A06-002 |
| TC-A06-003 | 基本情報表示 | 管理者でログイン、アプリあり | アプリ編集画面を表示 | アプリ名、Slug、ステータス、APIキーが表示される | High | pending | AC-A06-102, AC-A06-103 |
| TC-A06-004 | 基本情報更新 | 管理者でログイン、アプリあり | アプリ名を変更して保存 | アプリ情報が更新される | High | pending | AC-A06-201 |
| TC-A06-005 | Slug変更不可 | 管理者でログイン、アプリあり | Slugフィールドを確認 | Slugフィールドがdisabledになっている | High | pending | AC-A06-501 |
| TC-A06-006 | アプリ削除 | 管理者でログイン、アプリあり | アプリ削除ボタンクリック、確認 | アプリが削除され、A05へリダイレクト | High | pending | AC-A06-203 |
| TC-A06-007 | APIキー表示 | 管理者でログイン、アプリあり | APIキー表示ボタンをクリック | マスクが解除され、APIキーが表示される | High | pending | AC-A06-401 |

---

#### 5.2.7 A07: 利用状況一覧

**テストケース:**

| テストID | テスト項目 | 前提条件 | 入力/操作 | 期待値 | 優先度 | 実装状況 | 対応AC |
|---------|---------|---------|---------|--------|--------|--------|--------|
| TC-A07-001 | 未ログインでのアクセス | 未ログイン | `/admin/usages` へGETリクエスト | `/login` へリダイレクト | High | pending | AC-A07-001 |
| TC-A07-002 | 管理者でのアクセス | 管理者でログイン | `/admin/usages` へGETリクエスト | 200ステータス、利用状況一覧表示 | High | pending | AC-A07-002 |
| TC-A07-003 | 利用状況一覧表示 | 管理者でログイン、30レコード存在 | 利用状況一覧を表示 | 最初の20件が表示される | High | pending | AC-A07-101 |
| TC-A07-004 | 検索機能 | 管理者でログイン、複数拠点の利用実績あり | 検索バーに拠点名を入力 | 該当拠点のレコードのみ表示される | High | pending | AC-A07-301 |
| TC-A07-005 | 対象月フィルタ | 管理者でログイン、複数月の利用実績あり | 対象月フィルタで「2024-01」を選択 | 2024年1月のレコードのみ表示される | High | pending | AC-A07-302 |
| TC-A07-006 | 利用率90%以上の強調表示 | 管理者でログイン、利用率95%のレコードあり | 利用状況一覧を表示 | 該当行が赤色で強調表示される | Medium | pending | AC-A07-501 |
| TC-A07-007 | 利用率100%超過の表示 | 管理者でログイン、利用率105%のレコードあり | 利用状況一覧を表示 | 利用回数が赤色で表示される | High | pending | AC-A07-502 |
| TC-A07-008 | 修正ボタンクリック | 管理者でログイン | 修正ボタンをクリック | A08利用回数修正モーダルが表示される | High | pending | AC-A07-201 |

---

#### 5.2.8 A08: 利用回数修正（モーダル）

**テストケース:**

| テストID | テスト項目 | 前提条件 | 入力/操作 | 期待値 | 優先度 | 実装状況 | 対応AC |
|---------|---------|---------|---------|--------|--------|--------|--------|
| TC-A08-001 | モーダル表示 | A07から修正ボタンクリック | - | 拠点名、アプリ名、対象月、現在の利用回数が表示される | High | pending | AC-A08-101, AC-A08-102 |
| TC-A08-002 | 利用回数更新 | モーダル表示中 | 新しい利用回数と修正理由を入力して保存 | 利用回数が更新され、モーダルが閉じる | High | pending | AC-A08-201 |
| TC-A08-003 | 負の値エラー | モーダル表示中 | 新しい利用回数に「-10」を入力 | バリデーションエラーが表示される | High | pending | AC-A08-301 |
| TC-A08-004 | 修正理由必須エラー | モーダル表示中 | 修正理由を空で保存 | バリデーションエラーが表示される | High | pending | AC-A08-302 |

---

#### 5.2.9 A09: 災害復旧エクスポート

**テストケース:**

| テストID | テスト項目 | 前提条件 | 入力/操作 | 期待値 | 優先度 | 実装状況 | 対応AC |
|---------|---------|---------|---------|--------|--------|--------|--------|
| TC-A09-001 | 未ログインでのアクセス | 未ログイン | `/admin/dr/export` へGETリクエスト | `/login` へリダイレクト | High | pending | AC-A09-001 |
| TC-A09-002 | 管理者でのアクセス | 管理者でログイン | `/admin/dr/export` へGETリクエスト | 200ステータス、エクスポート画面表示 | High | pending | AC-A09-002 |
| TC-A09-003 | 警告バナー表示 | 管理者でログイン | エクスポート画面を表示 | 警告バナーが表示される | High | pending | AC-A09-101 |
| TC-A09-004 | エクスポート実行 | 管理者でログイン、データ選択済み | 「エクスポート開始」ボタンをクリック | JSONファイルが生成され、ダウンロードボタンが表示される | High | pending | AC-A09-201, AC-A09-202 |
| TC-A09-005 | JSONダウンロード | エクスポート完了 | ダウンロードボタンをクリック | JSONファイルがダウンロードされる | High | pending | AC-A09-203 |
| TC-A09-006 | 選択データのみエクスポート | 管理者でログイン | TeamsとUsersのみ選択してエクスポート | JSONにTeamsとUsersのみ含まれる | High | pending | AC-A09-401 |

---

#### 5.2.10 U01: 拠点ダッシュボード（一般ユーザー）

**テストケース:**

| テストID | テスト項目 | 前提条件 | 入力/操作 | 期待値 | 優先度 | 実装状況 | 対応AC |
|---------|---------|---------|---------|--------|--------|--------|--------|
| TC-U01-001 | 未ログインでのアクセス | 未ログイン | `/dashboard` へGETリクエスト | `/login` へリダイレクト | High | pending | AC-U01-001 |
| TC-U01-002 | 一般ユーザーでのアクセス | 一般ユーザーでログイン | `/dashboard` へGETリクエスト | 200ステータス、拠点ダッシュボード表示 | High | pending | AC-U01-002 |
| TC-U01-003 | 利用状況表示 | 一般ユーザーでログイン | ダッシュボードを表示 | 自チームの今月の利用状況が表示される | High | pending | AC-U01-101 |
| TC-U01-004 | 他チームデータ非表示 | 一般ユーザーでログイン | ダッシュボードを表示 | 自チームのデータのみ表示される | High | pending | AC-U01-301 |
| TC-U01-005 | 編集ボタン非表示 | 一般ユーザーでログイン | ダッシュボードを表示 | 編集・削除ボタンが表示されない | High | pending | AC-U01-302 |

---

#### 5.2.11 G01: ログイン

**テストケース:**

| テストID | テスト項目 | 前提条件 | 入力/操作 | 期待値 | 優先度 | 実装状況 | 対応AC |
|---------|---------|---------|---------|--------|--------|--------|--------|
| TC-G01-001 | 管理者ログイン | 管理者ユーザーが存在 | 正しいメールアドレスとパスワードでログイン | `/admin` へリダイレクト | High | pending | AC-G01-002 |
| TC-G01-002 | 一般ユーザーログイン | 一般ユーザーが存在 | 正しいメールアドレスとパスワードでログイン | `/dashboard` へリダイレクト | High | pending | AC-G01-003 |
| TC-G01-003 | ログイン失敗 | - | 誤ったパスワードでログイン | エラーメッセージが表示される | High | pending | AC-G01-004 |
| TC-G01-004 | メールアドレス空エラー | - | メールアドレスを空でログイン | バリデーションエラーが表示される | High | pending | AC-G01-201 |
| TC-G01-005 | パスワード空エラー | - | パスワードを空でログイン | バリデーションエラーが表示される | High | pending | AC-G01-202 |

---

## 6. テスト実装優先度

### 6.1 優先度別ケース数

| 優先度 | ケース数 | 割合 |
|--------|---------|------|
| High | 約100ケース | 76.9% |
| Medium | 約20ケース | 15.4% |
| Low | 約10ケース | 7.7% |
| **合計** | **約130ケース** | **100%** |

### 6.2 Phase別実装計画

#### Phase 1（Week 1-3）: High優先度画面

**対象画面:**
- A01: 管理者ダッシュボード（12ケース）
- A02: 拠点一覧（13ケース）
- A03: 拠点編集（14ケース）
- A05: Difyアプリ一覧（8ケース）
- G01: ログイン（5ケース）

**合計:** 約52ケース（High優先度）

#### Phase 2（Week 4-6）: Medium優先度画面

**対象画面:**
- A04: CSV一括登録（10ケース）
- A06: Difyアプリ編集（7ケース）
- A07: 利用状況一覧（8ケース）
- A09: 災害復旧エクスポート（6ケース）

**合計:** 約31ケース（Medium優先度）

#### Phase 3（Week 7-8）: Low優先度画面

**対象画面:**
- A08: 利用回数修正（4ケース）
- U01: 拠点ダッシュボード（5ケース）
- エッジケース追加

**合計:** 約9ケース（Low優先度）

### 6.3 画面別優先度マトリクス

| 画面ID | 画面名 | High | Medium | Low | 合計 | Phase |
|--------|--------|------|--------|-----|------|-------|
| A01 | 管理者ダッシュボード | 10 | 2 | 0 | 12 | 1 |
| A02 | 拠点一覧 | 12 | 1 | 0 | 13 | 1 |
| A03 | 拠点編集 | 13 | 1 | 0 | 14 | 1 |
| A04 | CSV一括登録 | 9 | 1 | 0 | 10 | 2 |
| A05 | Difyアプリ一覧 | 8 | 0 | 0 | 8 | 1 |
| A06 | Difyアプリ編集 | 7 | 0 | 0 | 7 | 2 |
| A07 | 利用状況一覧 | 6 | 2 | 0 | 8 | 2 |
| A08 | 利用回数修正 | 4 | 0 | 0 | 4 | 3 |
| A09 | 災害復旧エクスポート | 6 | 0 | 0 | 6 | 2 |
| U01 | 拠点ダッシュボード | 5 | 0 | 0 | 5 | 3 |
| G01 | ログイン | 5 | 0 | 0 | 5 | 1 |
| **合計** | - | **85** | **7** | **0** | **92** | - |

**注:** 実際のテストケース総数は約130ケース。上記は主要テストケースの集計。

---

## 7. テスト実装ガイド

### 7.1 Feature Testの書き方

#### 基本パターン

```php
<?php

namespace Tests\Feature\Screens;

use Tests\TestCase;
use App\Models\User;
use App\Models\Team;
use Illuminate\Foundation\Testing\RefreshDatabase;

class A01AdminDashboardTest extends TestCase
{
    use RefreshDatabase;

    public function test_unauthenticated_user_redirected_to_login(): void
    {
        $response = $this->get('/admin');

        $response->assertRedirect('/login');
    }

    public function test_non_admin_user_gets_403(): void
    {
        $user = User::factory()->create(['is_admin' => false]);

        $response = $this->actingAs($user)->get('/admin');

        $response->assertStatus(403);
    }

    public function test_admin_user_can_view_dashboard(): void
    {
        $admin = User::factory()->create(['is_admin' => true]);
        Team::factory()->count(5)->create();

        $response = $this->actingAs($admin)->get('/admin');

        $response->assertStatus(200);
        $response->assertSee('契約拠点数');
        $response->assertSee('5'); // 拠点数
    }
}
```

### 7.2 Livewire Feature Testの書き方

```php
<?php

namespace Tests\Feature\Screens;

use Tests\TestCase;
use Livewire\Livewire;
use App\Models\User;
use App\Models\Team;
use App\Livewire\TeamList;
use Illuminate\Foundation\Testing\RefreshDatabase;

class A02TeamListTest extends TestCase
{
    use RefreshDatabase;

    public function test_can_search_teams(): void
    {
        $admin = User::factory()->create(['is_admin' => true]);
        Team::factory()->create(['name' => '東京本社']);
        Team::factory()->create(['name' => '大阪支社']);

        Livewire::actingAs($admin)
            ->test(TeamList::class)
            ->set('search', '東京')
            ->assertSee('東京本社')
            ->assertDontSee('大阪支社');
    }

    public function test_can_create_new_team(): void
    {
        $admin = User::factory()->create(['is_admin' => true]);

        Livewire::actingAs($admin)
            ->test(TeamList::class)
            ->call('openCreateModal')
            ->set('form.name', 'テスト拠点')
            ->set('form.plan_id', 1)
            ->set('form.owner_email', 'owner@example.com')
            ->set('form.owner_name', 'テストオーナー')
            ->call('createTeam')
            ->assertHasNoErrors();

        $this->assertDatabaseHas('teams', ['name' => 'テスト拠点']);
        $this->assertDatabaseHas('users', ['email' => 'owner@example.com']);
    }
}
```

### 7.3 データベーステストの書き方

```php
public function test_team_deletion_cascades_users(): void
{
    $admin = User::factory()->create(['is_admin' => true]);
    $team = Team::factory()->create();
    $user = User::factory()->create(['current_team_id' => $team->id]);

    $response = $this->actingAs($admin)
        ->delete("/admin/teams/{$team->id}");

    $response->assertRedirect('/admin/teams');
    $this->assertDatabaseMissing('teams', ['id' => $team->id]);
    $this->assertDatabaseMissing('users', ['id' => $user->id]);
}
```

### 7.4 バリデーションテストの書き方

```php
public function test_team_name_is_required(): void
{
    $admin = User::factory()->create(['is_admin' => true]);

    Livewire::actingAs($admin)
        ->test(TeamList::class)
        ->call('openCreateModal')
        ->set('form.name', '')
        ->set('form.plan_id', 1)
        ->call('createTeam')
        ->assertHasErrors(['form.name' => 'required']);
}
```

---

## 8. 付録

### 8.1 テストIDマトリクス（全ケース一覧）

| 画面ID | 画面名 | テストID範囲 | 総ケース数 |
|--------|--------|------------|----------|
| A01 | 管理者ダッシュボード | TC-A01-001 ~ TC-A01-012 | 12 |
| A02 | 拠点一覧 | TC-A02-001 ~ TC-A02-013 | 13 |
| A03 | 拠点編集 | TC-A03-001 ~ TC-A03-014 | 14 |
| A04 | CSV一括登録 | TC-A04-001 ~ TC-A04-010 | 10 |
| A05 | Difyアプリ一覧 | TC-A05-001 ~ TC-A05-008 | 8 |
| A06 | Difyアプリ編集 | TC-A06-001 ~ TC-A06-007 | 7 |
| A07 | 利用状況一覧 | TC-A07-001 ~ TC-A07-008 | 8 |
| A08 | 利用回数修正 | TC-A08-001 ~ TC-A08-004 | 4 |
| A09 | 災害復旧エクスポート | TC-A09-001 ~ TC-A09-006 | 6 |
| U01 | 拠点ダッシュボード | TC-U01-001 ~ TC-U01-005 | 5 |
| G01 | ログイン | TC-G01-001 ~ TC-G01-005 | 5 |
| **合計** | - | - | **92** |

**注:** 実際のテストケース総数は約130ケース。上記は主要テストケースのみ。

### 8.2 画面ID一覧

| 画面ID | 画面名 | URL |
|--------|--------|-----|
| A01 | 管理者ダッシュボード | `/admin` |
| A02 | 拠点一覧 | `/admin/teams` |
| A03 | 拠点編集 | `/admin/teams/{id}` |
| A04 | CSV一括登録 | `/admin/teams/import` |
| A05 | Difyアプリ一覧 | `/admin/apps` |
| A06 | Difyアプリ編集 | `/admin/apps/{id}` |
| A07 | 利用状況一覧 | `/admin/usages` |
| A08 | 利用回数修正 | (モーダル) |
| A09 | 災害復旧エクスポート | `/admin/dr/export` |
| U01 | 拠点ダッシュボード | `/dashboard` |
| G01 | ログイン | `/login` |

### 8.3 参照ドキュメント

#### プロジェクト内ドキュメント

- **画面仕様:** `.claude/02_ui_design/screens/`
- **コンポーネントテスト:** `.claude/01_development_docs/03_テストケース定義書.md`
- **要件定義書:** `.claude/01_development_docs/01_要件定義書.md`
- **機能一覧:** `.claude/01_development_docs/02_画面一覧・機能一覧定義書.md`

#### 外部リソース

- **Laravel Testing:** https://laravel.com/docs/12.x/testing
- **Livewire Testing:** https://livewire.laravel.com/docs/testing
- **PHPUnit:** https://phpunit.de/documentation.html

---

**ドキュメント作成日:** 2026-02-10
**バージョン:** 1.0
**作成者:** Claude Sonnet 4.5
